<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú†Û•Ø±Ø®ÛŒ Ø¨Û•Ø®ØªÛŒ Ù¾Ú•Û†ÙÛŒØ´Ù†Ø§Úµ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rudaw:wght@400;700&display=swap');

        :root {
            --primary: #6366f1;
            --secondary: #4f46e5;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f8fafc;
            --accent: #ec4899;
            --danger: #ef4444;
            --success: #22c55e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Rudaw', 'Arial', sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            margin-top: 10px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #818cf8, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
            max-width: 1300px;
        }

        /* Left Panel */
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 350px;
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #334155;
        }

        .section-title {
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: var(--primary);
            border-bottom: 2px solid #334155;
            padding-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        input[type="text"] {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #475569;
            background: #0f172a;
            color: white;
            outline: none;
        }

        input[type="text"]:focus { border-color: var(--primary); }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            font-size: 0.9rem;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--secondary); }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            width: 100%;
            margin-bottom: 10px;
        }
        .btn-outline:hover { background: rgba(99, 102, 241, 0.1); }

        .name-list {
            max-height: 200px;
            overflow-y: auto;
            list-style: none;
            padding-right: 5px;
        }

        .name-list::-webkit-scrollbar { width: 6px; }
        .name-list::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }

        .name-item {
            background: #334155;
            margin-bottom: 6px;
            padding: 8px 12px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .btn-icon {
            background: transparent;
            color: #94a3b8;
            padding: 4px;
        }
        .btn-icon:hover { color: var(--danger); }

        /* Settings Toggles */
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }

        .switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #475569;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(18px); }

        /* Wheel Area */
        .wheel-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-width: 350px;
            position: relative;
        }

        .wheel-container {
            position: relative;
            width: 500px;
            height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(0,0,0,0.4);
            border: 10px solid white;
        }

        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 50px;
            background: var(--accent);
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 20;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5));
        }

        .spin-btn {
            position: absolute;
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 10;
            font-weight: bold;
            font-size: 1.3rem;
            color: var(--bg);
            border: 6px solid var(--primary);
            user-select: none;
            transition: transform 0.2s;
        }

        .spin-btn:hover { transform: scale(1.05); }
        .spin-btn:active { transform: scale(0.95); }

        /* History Panel */
        .history-list {
            font-size: 0.85rem;
            color: #cbd5e1;
        }
        .history-item {
            padding: 5px 0;
            border-bottom: 1px solid #334155;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid var(--accent);
            max-width: 90%;
            width: 400px;
            position: relative;
        }

        .winner-name {
            font-size: 3rem;
            color: var(--accent);
            margin: 20px 0;
            font-weight: bold;
        }

        /* Bulk Edit Modal */
        textarea {
            width: 100%;
            height: 200px;
            background: #0f172a;
            color: white;
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 10px;
            resize: none;
            margin-bottom: 15px;
        }

        @media (max-width: 900px) {
            .container { flex-direction: column-reverse; align-items: center; }
            .wheel-container { width: 350px; height: 350px; }
            .side-panel { max-width: 100%; }
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Ú†Û•Ø±Ø®ÛŒ Ø¨Û•Ø®Øª</h1>
        <p>Ø¨Ø§Ø´ØªØ±ÛŒÙ† Ø¦Û•Ø²Ù…ÙˆÙˆÙ† Ø¨Û† Ù‡Û•ÚµØ¨Ú˜Ø§Ø±Ø¯Ù†ÛŒ Ø¨Ø±Ø§ÙˆÛ•</p>
    </div>

    <div class="container">
        
        <div class="side-panel">
            
            <div class="card">
                <h3 class="section-title">Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†</h3>
                
                <div class="setting-row">
                    <label>Ù„Ø§Ø¯Ø§Ù†ÛŒ Ø¨Ø±Ø§ÙˆÛ• Ø¨Û• Ø´ÛÙˆÛ•ÛŒ Ø¦Û†ØªÛ†Ù…Ø§ØªÛŒÚ©</label>
                    <label class="switch">
                        <input type="checkbox" id="autoRemoveToggle">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="setting-row">
                    <label>Ú†Ø§Ù„Ø§Ú©Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û•Ù†Ú¯</label>
                    <label class="switch">
                        <input type="checkbox" id="soundToggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="setting-row" style="display:block">
                    <label style="margin-bottom:5px; display:block; font-size:0.85rem">Ù…Ø§ÙˆÛ•ÛŒ Ø³ÙˆÙˆÚ•Ø§Ù†Û•ÙˆÛ•: <span id="timeDisplay">5</span> Ú†Ø±Ú©Û•</label>
                    <input type="range" id="spinTime" min="1" max="10" value="5" style="width:100%" oninput="document.getElementById('timeDisplay').innerText = this.value">
                </div>
            </div>

             <div class="card">
                <h3 class="section-title">Ù…ÛÚ˜ÙˆÙˆÛŒ Ø¨Ø±Ø§ÙˆÛ•Ú©Ø§Ù† <button class="btn-icon" onclick="clearHistory()" title="Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•">ğŸ—‘ï¸</button></h3>
                <div id="historyList" class="history-list">
                    <div style="text-align:center; color:#64748b; padding:10px">Ù‡ÛØ´ØªØ§ Ù‡ÛŒÚ† Ø¨Ø±Ø§ÙˆÛ•ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•</div>
                </div>
            </div>

        </div>

        <div class="wheel-area">
            <div class="wheel-container">
                <div class="pointer"></div>
                <canvas id="wheelCanvas" width="600" height="600"></canvas>
                <div class="spin-btn" onclick="spinWheel()">Ø³ÙˆÙˆÚ•Ø§Ù†</div>
            </div>
        </div>

        <div class="side-panel">
            <div class="card">
                <h3 class="section-title">
                    Ù„ÛŒØ³ØªÛŒ Ù†Ø§ÙˆÛ•Ú©Ø§Ù† (<span id="countNames">0</span>)
                </h3>
                
                <button class="btn-outline" onclick="openBulkModal()">ğŸ“ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† Ø¨Û• Ú©Û†Ù…Û•Úµ (List Edit)</button>

                <div class="input-group">
                    <input type="text" id="nameInput" placeholder="Ù†Ø§Ùˆ Ø¨Ù†ÙˆÙˆØ³Û•..." onkeypress="handleEnter(event)">
                    <button class="btn-primary" onclick="addName()">+</button>
                </div>

                <ul class="name-list" id="nameList">
                    </ul>
            </div>
        </div>

    </div>

    <div class="modal" id="winnerModal">
        <div class="modal-content">
            <h2 style="color:#94a3b8">ğŸ‰ Ù¾ÛŒØ±Û†Ø²Û•! Ø¨Ø±Ø§ÙˆÛ• Ø¨Ø±ÛŒØªÛŒÛŒÛ• Ù„Û• ğŸ‰</h2>
            <div class="winner-name" id="winnerText">---</div>
            <button class="btn-primary" style="width:100%" onclick="closeWinnerModal()">Ø¯Ø§Ø®Ø³ØªÙ†</button>
        </div>
    </div>

    <div class="modal" id="bulkModal">
        <div class="modal-content" style="width: 500px;">
            <h3 style="margin-bottom:10px; color:white">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù†Ø§ÙˆÛ•Ú©Ø§Ù†</h3>
            <p style="font-size:0.9rem; color:#94a3b8; margin-bottom:10px;">Ù‡Û•Ø± Ù†Ø§ÙˆÛÚ© Ù„Û• Ø¯ÛÚ•ÛÚ©ÛŒ Ø¬ÛŒØ§ÙˆØ§Ø² Ø¨Ù†ÙˆÙˆØ³Û•:</p>
            <textarea id="bulkText"></textarea>
            <div style="display:flex; gap:10px">
                <button class="btn-outline" onclick="document.getElementById('bulkModal').style.display='none'">Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•</button>
                <button class="btn-primary" style="flex:1" onclick="saveBulkNames()">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        // --- Variables & Setup ---
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        
        // Default Data
        let names = ["Ø¦Û•Ø­Ù…Û•Ø¯", "Ø³Ø§Ø±Ø§", "Ù…Ø­Û•Ù…Û•Ø¯", "Ú•Û†Ú˜ÛŒÙ†", "Ú©Ø§Ø±Ø¯Û†", "Ø¯ÛŒÙ„Ø§Ù†", "Ù‡Û•Ú˜Ø§Ø±", "Ù†ÛŒØ§Ù†"];
        let winnersHistory = [];
        
        // Audio Context for Generating Sounds (No external files needed!)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // State
        let currentRotation = 0;
        let isSpinning = false;
        let currentWinner = "";
        let currentWinnerIndex = -1;

        // Colors
        const colors = ['#ef4444', '#f97316', '#f59e0b', '#10b981', '#06b6d4', '#3b82f6', '#6366f1', '#8b5cf6', '#ec4899'];

        // --- Initialization ---
        function init() {
            renderNameList();
            drawWheel();
            updateCount();
        }

        // --- Sound Logic (Synthesized) ---
        function playTickSound() {
            if (!document.getElementById('soundToggle').checked) return;
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime); // High pitch click
            
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.05);
        }

        function playWinSound() {
            if (!document.getElementById('soundToggle').checked) return;
            
            // Simple Fanfare using multiple oscillators
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C Major Chord
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1);
                    osc.start();
                    osc.stop(audioCtx.currentTime + 1);
                }, i * 100);
            });
        }

        // --- Core Logic ---

        function spinWheel() {
            if (isSpinning || names.length === 0) return;
            
            // Resume Audio Context if blocked by browser policy
            if (audioCtx.state === 'suspended') audioCtx.resume();

            isSpinning = true;
            const duration = parseInt(document.getElementById('spinTime').value);
            
            // Calculate Spin
            const minSpins = 5;
            const randomDegree = Math.floor(Math.random() * 360);
            const totalSpin = (minSpins * 360) + randomDegree;
            
            currentRotation += totalSpin;
            
            // CSS Transition
            canvas.style.transition = `transform ${duration}s cubic-bezier(0.25, 0.1, 0.25, 1)`;
            canvas.style.transform = `rotate(-${currentRotation}deg)`;

            // Sound Effect Loop (Simulating Ticks)
            let startTime = Date.now();
            let tickInterval = 50; // Start fast
            
            function tickLoop() {
                if (!isSpinning) return;
                
                let elapsed = (Date.now() - startTime) / 1000;
                let progress = elapsed / duration;
                
                if (progress < 1) {
                    // Slow down ticks as we approach end
                    let dynamicInterval = 50 + (progress * 400); // Increases time between ticks
                    playTickSound();
                    setTimeout(tickLoop, dynamicInterval);
                }
            }
            tickLoop();

            // Wait for finish
            setTimeout(() => {
                isSpinning = false;
                determineWinner(currentRotation);
            }, duration * 1000);
        }

        function determineWinner(rotation) {
            const numSegments = names.length;
            const degPerSegment = 360 / numSegments;
            
            // Pointer at TOP (270deg) fix
            const effectiveRotation = rotation % 360;
            let winningAngle = (270 + effectiveRotation) % 360;
            let winningIndex = Math.floor(winningAngle / degPerSegment);
            winningIndex = (winningIndex + numSegments) % numSegments; // normalization

            currentWinner = names[winningIndex];
            currentWinnerIndex = winningIndex;

            showWinnerModal();
        }

        function showWinnerModal() {
            playWinSound();
            launchConfetti();
            
            document.getElementById('winnerText').innerText = currentWinner;
            document.getElementById('winnerModal').style.display = 'flex';

            // Add to History
            addToHistory(currentWinner);
        }

        function closeWinnerModal() {
            document.getElementById('winnerModal').style.display = 'none';
            
            // Check Auto Remove Setting
            const autoRemove = document.getElementById('autoRemoveToggle').checked;
            
            if (autoRemove && currentWinnerIndex !== -1) {
                removeName(currentWinnerIndex);
                currentWinnerIndex = -1; // Reset
            }
        }

        // --- List Management ---

        function addName() {
            const input = document.getElementById('nameInput');
            const val = input.value.trim();
            if (val) {
                names.push(val);
                input.value = '';
                renderNameList();
                drawWheel();
            }
        }

        function removeName(index) {
            if (isSpinning) return;
            names.splice(index, 1);
            renderNameList();
            drawWheel();
        }

        function saveBulkNames() {
            const text = document.getElementById('bulkText').value;
            const newNames = text.split('\n').map(n => n.trim()).filter(n => n !== "");
            if (newNames.length > 0) {
                names = newNames;
                renderNameList();
                drawWheel();
                document.getElementById('bulkModal').style.display = 'none';
            }
        }

        function openBulkModal() {
            document.getElementById('bulkText').value = names.join('\n');
            document.getElementById('bulkModal').style.display = 'flex';
        }

        function renderNameList() {
            const list = document.getElementById('nameList');
            list.innerHTML = '';
            names.forEach((name, index) => {
                list.innerHTML += `
                    <li class="name-item">
                        <span>${index+1}. ${name}</span>
                        <button class="btn-icon" onclick="removeName(${index})">âœ–</button>
                    </li>
                `;
            });
            updateCount();
        }

        function addToHistory(name) {
            winnersHistory.unshift(name); // Add to top
            const list = document.getElementById('historyList');
            list.innerHTML = winnersHistory.map(n => `
                <div class="history-item">ğŸ† ${n}</div>
            `).join('');
        }

        function clearHistory() {
            winnersHistory = [];
            document.getElementById('historyList').innerHTML = '<div style="text-align:center; color:#64748b; padding:10px">Ù…ÛÚ˜ÙˆÙˆ Ù¾Ø§Ú©Ú©Ø±Ø§ÛŒÛ•ÙˆÛ•</div>';
        }

        function updateCount() {
            document.getElementById('countNames').innerText = names.length;
        }

        function handleEnter(e) {
            if (e.key === 'Enter') addName();
        }

        // --- Canvas Drawing ---
        function drawWheel() {
            const numSegments = names.length;
            const arcSize = (2 * Math.PI) / numSegments;
            const radius = canvas.width / 2;
            const cx = radius;
            const cy = radius;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (numSegments === 0) return;

            names.forEach((name, i) => {
                const angle = i * arcSize;
                
                // Slice
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, radius, angle, angle + arcSize);
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();
                ctx.stroke(); // White border

                // Text
                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(angle + arcSize / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 28px 'Rudaw', Arial";
                ctx.shadowColor = "rgba(0,0,0,0.5)";
                ctx.shadowBlur = 4;
                ctx.fillText(name, radius - 40, 10);
                ctx.restore();
            });
        }

        // --- Confetti ---
        function launchConfetti() {
            var duration = 2000;
            var end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        init();

    </script>
</body>
</html>
